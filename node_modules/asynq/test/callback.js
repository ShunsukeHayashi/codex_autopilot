
var assert = require('assert');

var error = function(callback){
	setImmediate(function(){
		callback(new Error());
	});
};

var noResult = function(callback){
	setImmediate(function(){
		callback(null);
	});
};

var oneResult = function(callback){
	setImmediate(function(){
		callback(null, 1);
	});
};

var manyResult = function(callback){
	setImmediate(function(){
		callback(null, 1, 2);
	});
};

var asynq = require('..');

describe('asynq.callback', function () {

  it('should pass no result', function () {
    return asynq(function* () {
    	var data = yield noResult(asynq.callback);
        assert.deepEqual(data, undefined);
    });
  })

  it('should pass one result', function () {
    return asynq(function* () {
    	var data = yield oneResult(asynq.callback);
        assert.deepEqual(data, 1);
    });
  })

  it('should pass many result', function () {
    return asynq(function* () {
    	var data = yield manyResult(asynq.callback);
        assert.deepEqual(data, [1, 2]);
    });
  })

  it('should thrown error', function () {
    return asynq(function* () {
    	var err = null;
    	try{
        	yield error(asynq.callback);
    	}catch(e){
    		err = e;
    	}
    	assert(err != null);
    });
  })
})
